{
  "owner": "power-IoT-terminal",
  "repo": "power-iot-traffic",
  "branch": "main",
  "message": "feat: 完善命令式弹窗和包级特征页面",
  "files": [
    {
      "file_path": "src/App.vue",
      "content": "<template>\n  <a-config-provider :theme=\"themeConfig\" :locale=\"locale\">\n    <MxModalProvider>\n      <router-view />\n    </MxModalProvider>\n  </a-config-provider>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport zhCN from 'ant-design-vue/es/locale/zh_CN'\nimport { useThemeStore } from '@/store/theme'\nimport { MxModalProvider } from '@/components/MxModal'\n\n// 主题 store\nconst themeStore = useThemeStore()\n\n// 主题配置\nconst themeConfig = computed(() => themeStore.themeConfig)\n\n// 语言配置 - 使用中文\nconst locale = zhCN\n</script>\n"
    },
    {
      "file_path": "src/components/MxButton/MxButton.vue",
      "content": "<template>\n  <a-button\n    v-if=\"hasPermission\"\n    v-bind=\"buttonProps\"\n    :class=\"props.customClass\"\n    @click=\"handleClick\"\n  >\n    <template #icon>\n      <slot name=\"icon\">\n        <!-- 调试信息 -->\n        <template v-if=\"false\">{{ props.iconType }}{{ showIcon }}</template>\n        <EditOutlined v-if=\"props.iconType === 'edit' && showIcon\" />\n        <EyeOutlined v-else-if=\"props.iconType === 'view' && showIcon\" />\n        <CopyOutlined v-else-if=\"props.iconType === 'copy' && showIcon\" />\n        <PlusOutlined v-else-if=\"props.iconType === 'add' && showIcon\" />\n        <ReloadOutlined v-else-if=\"props.iconType === 'refresh' && showIcon\" />\n        <SaveOutlined v-else-if=\"props.iconType === 'save' && showIcon\" />\n        <CloseOutlined v-else-if=\"props.iconType === 'cancel' && showIcon\" />\n        <PrinterOutlined v-else-if=\"props.iconType === 'print' && showIcon\" />\n        <DownloadOutlined v-else-if=\"props.iconType === 'export' && showIcon\" />\n      </slot>\n    </template>\n    <slot>\n      {{ displayText }}\n    </slot>\n  </a-button>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, inject, onMounted, onUnmounted } from 'vue'\nimport debounceFn from 'lodash/debounce'\nimport {\n  EditOutlined,\n  EyeOutlined,\n  CopyOutlined,\n  PlusOutlined,\n  ReloadOutlined,\n  SaveOutlined,\n  CloseOutlined,\n  PrinterOutlined,\n  DownloadOutlined\n} from '@ant-design/icons-vue'\nimport type { MxButtonProps, MxButtonEmits, IconType } from './buttonTypes'\n\n/**\n * MxButton 按钮组件\n * 基于 Ant Design Vue Button 的二次封装\n * 完全兼容 ant-design-vue Button 组件的所有属性和事件\n * 支持权限控制、预设图标、防抖等\n *\n * 使用 Provide/Inject 注入权限检查函数\n * 在应用入口配置：\n * ```ts\n * const checkPermission = (permission: string | string[]) => boolean\n * app.provide('checkPermission', checkPermission)\n * ```\n *\n * @example\n * ```vue\n * <!-- 基础用法 -->\n * <mx-button @click=\"handleClick\">按钮</mx-button>\n *\n * <!-- 预设图标 -->\n * <mx-button icon-type=\"edit\" @click=\"handleEdit\">编辑</mx-button>\n *\n * <!-- 防抖 -->\n * <mx-button icon-type=\"copy\" :debounce=\"300\" @click=\"handleCopy\">复制</mx-button>\n * ```\n */\ndefineOptions({\n  name: 'MxButton'\n})\n\ninterface Props {\n  // ButtonProps 基础属性\n  type?: 'primary' | 'default' | 'dashed' | 'link' | 'text'\n  size?: 'large' | 'middle' | 'small'\n  loading?: boolean | { delay: number }\n  disabled?: boolean\n  block?: boolean\n  danger?: boolean\n  ghost?: boolean\n  shape?: 'default' | 'circle' | 'round'\n  htmlType?: 'button' | 'submit' | 'reset'\n  icon?: any\n  href?: string\n  target?: string\n  // 自定义属性\n  customClass?: string\n  permission?: string | string[]\n  iconType?: IconType\n  hideIcon?: boolean\n  debounce?: number\n  defaultText?: string\n  loadingText?: string\n  // 允许其他 ButtonProps 属性\n  [key: string]: any\n}\n\n// Props 定义\nconst props = withDefaults(defineProps<Props>(), {\n  type: 'default',\n  size: 'middle',\n  loading: false,\n  disabled: false,\n  block: false,\n  danger: false,\n  ghost: false,\n  shape: 'default',\n  htmlType: 'button',\n  icon: undefined,\n  href: undefined,\n  target: undefined,\n  customClass: '',\n  permission: undefined,\n  iconType: undefined,\n  hideIcon: false,\n  debounce: 0,\n  defaultText: undefined,\n  loadingText: undefined\n})\n\n// 事件定义\nconst emit = defineEmits<MxButtonEmits>()\n\n// 注入权限检查函数（可选）\nconst checkPermission = inject<(permission: string | string[]) => boolean>(\n  'checkPermission',\n  () => true\n)\n\n/** 默认文案映射 */\nconst defaultTextMap: Record<IconType, string> = {\n  edit: '编辑',\n  view: '查看',\n  copy: '复制',\n  add: '新增',\n  refresh: '刷新',\n  save: '保存',\n  cancel: '取消',\n  print: '打印',\n  export: '导出'\n}\n\n/** 显示文本 */\nconst displayText = computed(() => {\n  if (props.loading && props.loadingText) {\n    return props.loadingText\n  }\n  if (props.defaultText !== undefined) {\n    return props.defaultText\n  }\n  if (props.iconType && defaultTextMap[props.iconType]) {\n    return defaultTextMap[props.iconType]\n  }\n  return undefined\n})\n\n/** 检查是否有权限 */\nconst hasPermission = computed(() => {\n  // 如果没有传入权限，默认显示\n  if (!props.permission) return true\n\n  // 使用注入的权限检查函数\n  return checkPermission(props.permission)\n})\n\n/** 是否在加载状态 */\nconst isLoading = computed(() => {\n  if (typeof props.loading === 'boolean') {\n    return props.loading\n  }\n  if (typeof props.loading === 'object' && props.loading !== null) {\n    return true\n  }\n  return false\n})\n\n/** 是否显示图标 */\nconst showIcon = computed(() => {\n  const result = !props.hideIcon && !isLoading.value && !!props.iconType\n\n  return result\n})\n\n/** 按钮属性（排除自定义属性） */\nconst buttonProps = computed(() => {\n  const rest = { ...props } as Record<string, any>\n  delete rest.customClass\n  delete rest.permission\n  delete rest.iconType\n  delete rest.hideIcon\n  delete rest.debounce\n  delete rest.defaultText\n  delete rest.loadingText\n  return rest\n})\n\n/** 防抖函数 */\nconst debouncedClick = computed(() => {\n  if (props.debounce > 0) {\n    return debounceFn((event: MouseEvent) => {\n      emit('click', event)\n    }, props.debounce)\n  }\n  return (event: MouseEvent) => emit('click', event)\n})\n\n/** 处理点击 */\nconst handleClick = (event: MouseEvent) => {\n  debouncedClick.value(event)\n}\n\nonUnmounted(() => {\n  // 取消防抖\n  const debouncedFn = debouncedClick.value as any\n  if (debouncedFn && typeof debouncedFn.cancel === 'function') {\n    debouncedFn.cancel()\n  }\n})\n\n// 导出类型供 IDE 识别\nexport type { MxButtonProps, MxButtonEmits }\n\n// 扩展类型，包含 permission\nexport type MxButtonPropsWithPermission = MxButtonProps & {\n  permission?: string | string[]\n}\n</script>\n\n<style scoped lang=\"scss\">\n// 可在此添加自定义样式\n</style>\n"
    },
    {
      "file_path": "src/components/MxDeleteButton/MxDeleteButton.vue",
      "content": "<template>\n  <!-- 气泡确认框模式 -->\n  <a-popconfirm\n    v-if=\"confirm && confirmType === 'popconfirm'\"\n    :title=\"confirm\"\n    :ok-text=\"okText\"\n    :cancel-text=\"cancelText\"\n    :ok-button-props=\"{ loading: loading }\"\n    @confirm=\"handleConfirm\"\n  >\n    <template #icon>\n      <slot name=\"popconfirmIcon\">\n        <ExclamationCircleOutlined style=\"color: #ff4d4f\" />\n      </slot>\n    </template>\n    <mx-button\n      :type=\"type\"\n      :size=\"size\"\n      :disabled=\"disabled || loading\"\n      :loading=\"loading\"\n      :danger=\"true\"\n      :custom-class=\"customClass\"\n      :permission=\"permission\"\n    >\n      <template v-if=\"!hideIcon && !loading\" #icon>\n        <DeleteOutlined />\n      </template>\n      <slot>删除</slot>\n    </mx-button>\n  </a-popconfirm>\n\n  <!-- 模态框模式或无确认 -->\n  <mx-button\n    v-else\n    :type=\"type\"\n    :size=\"size\"\n    :disabled=\"disabled || loading\"\n    :loading=\"loading\"\n    :danger=\"true\"\n    :custom-class=\"customClass\"\n    :permission=\"permission\"\n    @click=\"handleClick\"\n  >\n    <template v-if=\"!hideIcon && !loading\" #icon>\n      <DeleteOutlined />\n    </template>\n    <slot>删除</slot>\n  </mx-button>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\nimport { Modal } from 'ant-design-vue'\nimport { DeleteOutlined, ExclamationCircleOutlined } from '@ant-design/icons-vue'\nimport MxButton from '../MxButton/MxButton.vue'\nimport type { MxDeleteButtonProps } from './deleteButtonTypes'\n\n/**\n * 删除按钮组件\n * 专用于删除操作，自动添加删除图标和危险样式\n * 支持权限控制、加载状态、确认对话框\n *\n * @example\n * <mx-delete-button @delete=\"handleDelete\" confirm=\"确定要删除吗？\" />\n *\n * @example\n * <mx-delete-button @delete=\"handleDelete\" confirm-type=\"popconfirm\" />\n *\n * @example\n * <mx-delete-button permission=\"delete\" @delete=\"handleDelete\" />\n */\ndefineOptions({\n  name: 'MxDeleteButton'\n})\n\nconst emit = defineEmits<{\n  delete: []\n}>()\n\ninterface Props extends MxDeleteButtonProps {}\n\nconst props = withDefaults(defineProps<Props>(), {\n  type: 'default',\n  size: 'middle',\n  disabled: false,\n  loading: false,\n  customClass: '',\n  confirm: '确定要删除吗？',\n  confirmType: 'modal',\n  confirmTitle: '确认删除',\n  okText: '确定',\n  cancelText: '取消',\n  hideIcon: false\n})\n\n// Modal 实例引用\nconst modalInstance = ref<{ update: (config: any) => void } | null>(null)\n\n// 监听 loading 状态变化，更新 Modal 确认按钮的 loading 状态\nwatch(\n  () => props.loading,\n  newLoading => {\n    if (modalInstance.value && typeof modalInstance.value.update === 'function') {\n      modalInstance.value.update({\n        okButtonProps: {\n          loading: newLoading\n        }\n      })\n    }\n  }\n)\n\n/** 等待 loading 完成的 Promise */\nconst waitLoadingComplete = (): Promise<void> => {\n  return new Promise(resolve => {\n    let hasControlledLoading = false\n\n    const stopWatcher = watch(\n      () => props.loading,\n      newLoading => {\n        if (newLoading) {\n          hasControlledLoading = true\n        } else if (hasControlledLoading) {\n          stopWatcher()\n          resolve()\n        }\n      },\n      { immediate: true }\n    )\n\n    // 如果外部没有控制 loading（始终为 false），在微任务中自动 resolve\n    if (!props.loading) {\n      queueMicrotask(() => {\n        if (!hasControlledLoading) {\n          stopWatcher()\n          resolve()\n        }\n      })\n    }\n  })\n}\n\n/** 处理点击（Modal 模式或无确认） */\nconst handleClick = () => {\n  if (!props.confirm) {\n    // 没有确认提示，直接触发删除\n    emit('delete')\n    return\n  }\n\n  // Modal 确认框\n  modalInstance.value = Modal.confirm({\n    title: props.confirmTitle,\n    content: props.confirm,\n    okText: props.okText,\n    cancelText: props.cancelText,\n    okButtonProps: {\n      loading: props.loading\n    },\n    onOk: () => {\n      // 触发删除事件\n      emit('delete')\n      // 等待 loading 完成后再关闭对话框\n      return waitLoadingComplete()\n    },\n    afterClose: () => {\n      modalInstance.value = null\n    }\n  })\n}\n\n/** 处理确认（Popconfirm 模式） */\nconst handleConfirm = () => {\n  // 触发删除事件\n  emit('delete')\n  // 等待 loading 完成后再关闭气泡框\n  return waitLoadingComplete()\n}\n</script>\n\n<style scoped lang=\"scss\"></style>\n"
    },
    {
      "file_path": "src/components/MxFormLayout/MxFormRow.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: 表单行布局组件，用于控制表单项的排列，自动布局\n * @Date: 2025-11-13 12:30:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 12:30:00\n-->\n<template>\n  <a-row :gutter=\"gutter\" :class=\"rowClass\">\n    <template v-for=\"item in children\" :key=\"item.key\">\n      <a-col :span=\"getSpan(item.node)\">\n        <component :is=\"item.node\" />\n      </a-col>\n    </template>\n  </a-row>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, useSlots, VNode, Fragment, Comment } from 'vue'\n\ndefineOptions({\n  name: 'MxFormRow'\n})\n\ninterface Props {\n  /** 每行显示的列数（1-24） */\n  cols?: number\n  /** 列间距 */\n  gutter?: number | [number, number]\n  /** 自定义类名 */\n  class?: string\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  cols: 1,\n  gutter: 16,\n  class: undefined\n})\n\nconst slots = useSlots()\n\n// 计算每列的 span\nconst colSpan = computed(() => Math.floor(24 / props.cols))\n\n// 获取子节点列表（扁平化处理）\nconst children = computed(() => {\n  const defaultSlot = slots.default?.()\n  if (!defaultSlot) return []\n\n  const result: Array<{ node: VNode; key: string | number | symbol }> = []\n  let counter = 0\n\n  const flattenNodes = (nodes: VNode[] | VNode) => {\n    const nodeArray = Array.isArray(nodes) ? nodes : [nodes]\n\n    nodeArray.forEach((node: any) => {\n      // 跳过文本节点和注释节点\n      if (typeof node === 'string' || typeof node === 'number' || !node) {\n        return\n      }\n\n      if (node.type === Comment) {\n        return\n      }\n\n      // 如果是 Fragment，递归处理其子节点\n      if (node.type === Fragment) {\n        if (node.children && Array.isArray(node.children)) {\n          flattenNodes(node.children as VNode[])\n        }\n      } else {\n        // 普通节点，直接添加，并生成 key\n        const key = node.key ?? `form-row-${counter++}`\n        result.push({ node, key })\n      }\n    })\n  }\n\n  flattenNodes(defaultSlot)\n  return result\n})\n\n// 获取节点的 span（支持通过 data-span 属性自定义）\nconst getSpan = (node: VNode): number => {\n  if (node.props && typeof node.props === 'object') {\n    // 支持 span 属性\n    if ('span' in node.props) {\n      const span = node.props.span\n      return typeof span === 'number' ? span : Number(span) || colSpan.value\n    }\n    // 支持 data-span 属性\n    if ('data-span' in node.props) {\n      const span = node.props['data-span']\n      return typeof span === 'number' ? span : Number(span) || colSpan.value\n    }\n  }\n  return colSpan.value\n}\n\n// 计算行类名\nconst rowClass = computed(() => {\n  return props.class\n})\n</script>\n"
    },
    {
      "file_path": "src/components/MxFormLayout/index.ts",
      "content": "/*\n * @Author: liaokt\n * @Description: MxFormLayout 模块导出\n * @Date: 2025-11-13 12:30:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 12:30:00\n */\nexport { default as MxFormRow } from './MxFormRow.vue'\n"
    },
    {
      "file_path": "src/components/MxModal/MxDetailModal.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: 通用详情弹窗组件\n * @Date: 2025-11-13 17:00:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 17:00:00\n-->\n<template>\n  <MxModal :modal=\"modal\" :show-ok=\"showOk\" :show-cancel=\"showCancel\">\n    <div :class=\"['mx-detail-modal', customClass]\">\n      <slot name=\"header\" :data=\"detailData\" />\n\n      <MxFormRow :cols=\"cols\" :gutter=\"gutter\" class=\"mx-detail-modal__grid\">\n        <div\n          v-for=\"item in normalizedItems\"\n          :key=\"item.key\"\n          class=\"mx-detail-modal__item\"\n          :class=\"{\n            'mx-detail-modal__item--full': item.span === 24,\n            'mx-detail-modal__item--empty': item.isPlaceholder\n          }\"\n          :data-span=\"item.span\"\n        >\n          <slot name=\"label\" :item=\"item\" :data=\"detailData\">\n            <div class=\"mx-detail-modal__label\">{{ item.label }}</div>\n          </slot>\n\n          <div :class=\"['mx-detail-modal__value', item.valueClass]\">\n            <template v-if=\"$slots[`value-${item.key}`]\">\n              <slot :name=\"`value-${item.key}`\" :item=\"item\" :data=\"detailData\" />\n            </template>\n            <template v-else-if=\"$slots.value\">\n              <slot name=\"value\" :item=\"item\" :data=\"detailData\" />\n            </template>\n            <template v-else-if=\"item.component\">\n              <component :is=\"item.component\" v-bind=\"item.componentProps\" />\n            </template>\n            <template v-else-if=\"item.type === 'tag'\">\n              <a-tag v-if=\"!item.isPlaceholder\" :color=\"item.tagColor || tagColor\">\n                {{ item.display }}\n              </a-tag>\n              <span v-else>{{ placeholder }}</span>\n            </template>\n            <template v-else>\n              {{ item.display }}\n            </template>\n          </div>\n        </div>\n      </MxFormRow>\n    </div>\n\n    <template v-if=\"$slots.footer\" #footer>\n      <slot name=\"footer\" :data=\"detailData\" />\n    </template>\n  </MxModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, type Component } from 'vue'\nimport { MxModal, useModal, type UseModalReturn } from '@/components/MxModal'\nimport { MxFormRow } from '@/components/MxFormLayout'\n\ndefineOptions({\n  name: 'MxDetailModal'\n})\n\ntype DetailValueType = 'default' | 'tag' | 'code' | 'block'\n\nexport interface DetailField {\n  key: string\n  label: string\n  span?: number\n  type?: DetailValueType\n  suffix?: string\n  formatter?: (value: unknown, data: Record<string, any>) => string\n  tagColor?: string\n  component?: Component\n  componentProps?: Record<string, any>\n}\n\ninterface NormalizedItem extends DetailField {\n  display: string\n  rawValue: unknown\n  valueClass?: string\n  isPlaceholder: boolean\n}\n\ninterface Props {\n  modal?: UseModalReturn\n  /** 详情字段配置 */\n  fields: DetailField[]\n  /** 详情数据（不传则自动从 modal 参数中获取） */\n  data?: Record<string, any>\n  /** 列数 */\n  cols?: number\n  /** 间距 */\n  gutter?: number | [number, number]\n  /** 占位符 */\n  placeholder?: string\n  /** 默认标签颜色 */\n  tagColor?: string\n  /** 自定义根样式类 */\n  customClass?: string\n  /** 是否显示确认按钮 */\n  showOk?: boolean\n  /** 是否显示取消按钮 */\n  showCancel?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  modal: undefined,\n  fields: () => [] as DetailField[],\n  data: undefined,\n  cols: 2,\n  gutter: () => [32, 24] as [number, number],\n  placeholder: '-',\n  tagColor: 'blue',\n  customClass: '',\n  showOk: false,\n  showCancel: false\n})\n\nconst modal = props.modal || useModal()\n\nconst detailData = computed<Record<string, any>>(() => {\n  if (props.data) {\n    return props.data\n  }\n  const args = modal.args.value\n  if (args.data && typeof args.data === 'object') {\n    return args.data as Record<string, any>\n  }\n  return modal.getFormData()\n})\n\nconst placeholder = computed(() => props.placeholder)\nconst tagColor = computed(() => props.tagColor)\nconst cols = computed(() => props.cols)\nconst gutter = computed(() => props.gutter)\nconst customClass = computed(() => props.customClass)\nconst showOk = computed(() => props.showOk)\nconst showCancel = computed(() => props.showCancel)\n\nconst valueClassMap: Record<DetailValueType, string | undefined> = {\n  default: undefined,\n  tag: 'mx-detail-modal__value--tag',\n  code: 'mx-detail-modal__value--code',\n  block: 'mx-detail-modal__value--block'\n}\n\nconst hasValue = (value: unknown): boolean => {\n  return !(value === null || value === undefined || value === '')\n}\n\nconst formatValue = (field: DetailField, value: unknown): string => {\n  if (field.formatter) {\n    return field.formatter(value, detailData.value)\n  }\n  if (!hasValue(value)) {\n    return placeholder.value\n  }\n  if (field.suffix) {\n    return `${value}${field.suffix}`\n  }\n  return String(value)\n}\n\nconst normalizedItems = computed<NormalizedItem[]>(() => {\n  return props.fields.map(field => {\n    const rawValue = detailData.value?.[field.key]\n    const display = formatValue(field, rawValue)\n    return {\n      ...field,\n      display,\n      rawValue,\n      isPlaceholder: display === placeholder.value,\n      valueClass: field.type ? valueClassMap[field.type] : undefined,\n      componentProps: {\n        ...field.componentProps,\n        value: rawValue,\n        data: detailData.value,\n        field\n      }\n    }\n  })\n})\n</script>\n\n<style scoped lang=\"scss\">\n.mx-detail-modal {\n  min-width: 520px;\n\n  &__grid {\n    margin-bottom: 24px;\n\n    :deep(.ant-row) {\n      width: 100%;\n    }\n  }\n\n  &__item {\n    display: flex;\n    flex-direction: column;\n    gap: 6px;\n\n    &--full {\n      width: 100%;\n    }\n  }\n\n  &__label {\n    color: #6f6f6f;\n    font-size: 13px;\n    font-weight: 500;\n    line-height: 1.6;\n  }\n\n  &__value {\n    color: #1f1f1f;\n    font-size: 14px;\n    font-weight: 500;\n    line-height: 1.6;\n    word-break: break-word;\n\n    &--tag {\n      display: inline-flex;\n      align-items: center;\n\n      :deep(.ant-tag) {\n        margin-inline-end: 0;\n        padding: 3px 12px;\n        border-radius: 4px;\n        font-size: 13px;\n        font-weight: 500;\n        line-height: 22px;\n      }\n    }\n\n    &--code {\n      font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New',\n        monospace;\n      font-size: 14px;\n      letter-spacing: 0.6px;\n      color: #3f3f3f;\n    }\n\n    &--block {\n      display: inline-block;\n      padding: 12px 16px;\n      background: #fafafa;\n      border: 1px solid #f0f0f0;\n      border-radius: 4px;\n      font-size: 14px;\n      font-weight: 500;\n      color: #3f3f3f;\n      line-height: 1.7;\n    }\n  }\n}\n</style>\n"
    },
    {
      "file_path": "src/components/MxModal/MxFormModal.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: 封装的表单 Modal 组件，基于 MxModal 系统\n * @Date: 2025-11-13 12:00:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 16:03:17\n-->\n<template>\n  <MxModal :modal=\"modal\" @ok=\"handleOk\" @cancel=\"handleCancel\">\n    <a-form\n      ref=\"formRef\"\n      :model=\"formData\"\n      :rules=\"rules\"\n      :layout=\"layout\"\n      :label-col=\"labelCol\"\n      :wrapper-col=\"wrapperCol\"\n    >\n      <slot :form-data=\"formData\" />\n    </a-form>\n  </MxModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { reactive, ref, watch, nextTick, toRaw, watchEffect } from 'vue'\nimport { useModal, type UseModalReturn } from './useModal'\nimport MxModal from './MxModal.vue'\nimport type { FormInstance, Rule } from 'ant-design-vue/es/form'\n\ndefineOptions({\n  name: 'MxFormModal'\n})\n\ninterface Props {\n  /** Modal 实例（从 modalRegistry 传递） */\n  modal?: UseModalReturn\n  /** 表单验证规则 */\n  rules?: Record<string, Rule[]>\n  /** 表单布局 */\n  layout?: 'horizontal' | 'vertical' | 'inline'\n  /** label 宽度 */\n  labelCol?: { span: number; offset?: number }\n  /** 输入框宽度 */\n  wrapperCol?: { span: number; offset?: number }\n  /** 是否在关闭时重置表单 */\n  resetOnClose?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  modal: undefined,\n  rules: () => ({}),\n  layout: 'vertical',\n  labelCol: undefined,\n  wrapperCol: undefined,\n  resetOnClose: true\n})\n\nconst emit = defineEmits<{\n  ok: [values: Record<string, any>]\n  cancel: []\n}>()\n\n// 如果传递了 modal prop，使用它；否则创建新的实例\nconst modal = props.modal || useModal()\nconst formRef = ref<FormInstance>()\n\n// 获取业务数据作为表单初始值\nconst formData = reactive<Record<string, any>>({})\n\nconst extractFormData = () => {\n  const args = toRaw(modal.args.value)\n  if (args.data && typeof args.data === 'object') {\n    return toRaw(args.data) as Record<string, any>\n  }\n  return toRaw(modal.getFormData())\n}\n\nconst assignFormData = (source: Record<string, any>) => {\n  const keys = Object.keys(formData)\n  keys.forEach(key => {\n    if (!(key in source)) {\n      delete formData[key]\n    }\n  })\n  Object.assign(formData, source)\n}\n\nconst previousVisible = ref(false)\n\nwatchEffect(() => {\n  const visible = modal.visible.value\n\n  if (visible) {\n    assignFormData(extractFormData())\n    nextTick(() => {\n      formRef.value?.clearValidate()\n    })\n  } else if (previousVisible.value && props.resetOnClose) {\n    assignFormData({})\n    nextTick(() => {\n      formRef.value?.resetFields()\n      formRef.value?.clearValidate()\n    })\n  }\n\n  previousVisible.value = visible\n})\n\n// 处理确认\nconst handleOk = async () => {\n  if (!formRef.value) {\n    modal.hide()\n    return\n  }\n\n  try {\n    // 验证表单\n    await formRef.value.validate()\n\n    // 触发 ok 事件，传递表单数据\n    emit('ok', { ...formData })\n  } catch (error) {\n    console.error('表单验证失败:', error)\n  }\n}\n\n// 处理取消\nconst handleCancel = () => {\n  emit('cancel')\n  modal.hide()\n}\n\n// 暴露表单实例和方法\ndefineExpose({\n  formRef,\n  formData,\n  validate: () => formRef.value?.validate(),\n  resetFields: () => formRef.value?.resetFields(),\n  clearValidate: () => formRef.value?.clearValidate(),\n  getFieldsValue: () => formRef.value?.getFieldsValue()\n})\n</script>\n"
    },
    {
      "file_path": "src/components/MxModal/MxModal.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: 封装的 a-modal 组件，基于 MxModal 系统\n * @Date: 2025-11-13 12:00:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 16:50:11\n-->\n<template>\n  <a-modal\n    :open=\"modal.visible.value\"\n    v-bind=\"modalProps\"\n    :body-style=\"{ paddingTop: '10px' }\"\n    @cancel=\"handleCancel\"\n    @ok=\"handleOk\"\n    @after-close=\"modal.remove()\"\n  >\n    <slot />\n    <template v-if=\"hasFooterSlot\" #footer>\n      <slot name=\"footer\" />\n    </template>\n  </a-modal>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, useSlots } from 'vue'\nimport { useModal, type UseModalReturn } from './useModal'\nimport type { ModalProps } from 'ant-design-vue'\n\ndefineOptions({\n  name: 'MxModal'\n})\n\ninterface Props {\n  /** Modal 实例（从 modalRegistry 传递） */\n  modal?: UseModalReturn\n  /** 是否显示确认按钮 */\n  showOk?: boolean\n  /** 是否显示取消按钮 */\n  showCancel?: boolean\n  /** 自定义确认按钮文字 */\n  okText?: string\n  /** 自定义取消按钮文字 */\n  cancelText?: string\n  /** 确认按钮加载状态 */\n  confirmLoading?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  modal: undefined,\n  showOk: true,\n  showCancel: true,\n  okText: '确定',\n  cancelText: '取消'\n})\n\nconst emit = defineEmits<{\n  ok: []\n  cancel: []\n}>()\n\n// 如果传递了 modal prop，使用它；否则创建新的实例\nconst modal = props.modal || useModal()\nconst slots = useSlots()\nconst hasFooterSlot = computed(() => Boolean(slots.footer))\n\n// 获取 a-modal 的参数（自动提取）\n// 使用 toRaw 避免响应式循环\nconst modalProps = computed<ModalProps>(() => {\n  const modalPropsFromArgs = modal.getModalProps()\n  const footerFromArgs = modalPropsFromArgs.footer\n  let footer: ModalProps['footer']\n\n  if (footerFromArgs !== undefined) {\n    footer = footerFromArgs\n  } else if (hasFooterSlot.value) {\n    footer = undefined\n  } else if (props.showOk || props.showCancel) {\n    footer = undefined\n  } else {\n    footer = null\n  }\n\n  return {\n    title: '提示',\n    width: 520,\n    okText: props.okText,\n    cancelText: props.cancelText,\n    confirmLoading: props.confirmLoading,\n    ...modalPropsFromArgs, // 从 args 中获取的参数会覆盖默认值\n    footer\n  }\n})\n\n// 处理确认\nconst handleOk = () => {\n  emit('ok')\n  // 由外部决定是否关闭（MxFormModal 会处理）\n}\n\n// 处理取消\nconst handleCancel = () => {\n  emit('cancel')\n  // 取消时总是关闭\n  modal.hide()\n}\n</script>\n"
    },
    {
      "file_path": "src/components/MxModal/MxModalProvider.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: Modal Provider 组件，用于全局管理 Modal 状态\n * @Date: 2025-11-13 11:30:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 11:30:00\n-->\n<template>\n  <slot />\n  <teleport to=\"body\">\n    <component :is=\"modal.component\" v-for=\"modal in modals\" :key=\"modal.id\" v-bind=\"modal.props\" />\n  </teleport>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, provide, onMounted, onUnmounted, markRaw, type Component } from 'vue'\nimport { setGlobalProvider } from './modalRegistry'\n\ndefineOptions({\n  name: 'MxModalProvider'\n})\n\ninterface ModalInstance {\n  id: string\n  component: Component\n  props: Record<string, any>\n}\n\nconst modals = ref<ModalInstance[]>([])\n\n/** 注册 Modal */\nconst register = (id: string, component: Component, props: Record<string, any> = {}) => {\n  const existingIndex = modals.value.findIndex(m => m.id === id)\n  if (existingIndex >= 0) {\n    // 更新已存在的 Modal\n    modals.value[existingIndex].props = { ...modals.value[existingIndex].props, ...props }\n  } else {\n    // 添加新的 Modal，使用 markRaw 避免组件被响应式化\n    modals.value.push({ id, component: markRaw(component), props })\n  }\n}\n\n/** 移除 Modal */\nconst unregister = (id: string) => {\n  const index = modals.value.findIndex(m => m.id === id)\n  if (index >= 0) {\n    modals.value.splice(index, 1)\n  }\n}\n\n/** 更新 Modal Props */\nconst update = (id: string, props: Partial<Record<string, any>>) => {\n  const modal = modals.value.find(m => m.id === id)\n  if (modal) {\n    modal.props = { ...modal.props, ...props }\n  }\n}\n\n/** 移除所有 Modal */\nconst removeAll = () => {\n  modals.value = []\n}\n\nconst provider = {\n  register,\n  unregister,\n  update,\n  removeAll\n}\n\n// 提供给子组件使用（通过 inject）\nprovide('mxModal', provider)\n\n// 设置全局 provider（用于非组件上下文）\nonMounted(() => {\n  setGlobalProvider(provider)\n})\n\nonUnmounted(() => {\n  setGlobalProvider(null as any)\n})\n</script>\n"
    },
    {
      "file_path": "src/components/MxModal/README.md",
      "content": "# MxModal 命令式弹窗系统\n\n类似 `@ebay/nice-modal-react` 的命令式弹窗方案，使用 Context Provider 全局管理 Modal 状态。\n\n## 特性\n\n- ✅ 命令式 API，无需在模板中声明组件\n- ✅ 全局状态管理，通过 Provider 统一管理\n- ✅ 支持 Promise，可以等待用户操作结果\n- ✅ 自动注册，无需手动管理\n- ✅ 类型安全，完整的 TypeScript 支持\n- ✅ 封装了 `MxFormModal`，简化表单弹窗开发\n- ✅ 自动区分业务数据和 `a-modal` 参数\n\n## 快速开始\n\n### 1. 在 App 中包裹 Provider\n\n```vue\n<!-- App.vue -->\n<template>\n  <a-config-provider :theme=\"themeConfig\" :locale=\"locale\">\n    <MxModalProvider>\n      <router-view />\n    </MxModalProvider>\n  </a-config-provider>\n</template>\n\n<script setup lang=\"ts\">\nimport { MxModalProvider } from '@/components/MxModal'\n</script>\n```\n\n### 2. 创建 Modal 组件\n\n#### 方式1：使用 MxFormModal（推荐，适用于表单场景）\n\n```vue\n<!-- components/UserModal.vue -->\n<template>\n  <MxFormModal :modal=\"modal\" :rules=\"rules\" layout=\"vertical\" @ok=\"handleSubmit\">\n    <template #default=\"{ formData }\">\n      <a-form-item label=\"姓名\" name=\"name\" required>\n        <a-input v-model:value=\"formData.name\" placeholder=\"请输入姓名\" />\n      </a-form-item>\n      <a-form-item label=\"年龄\" name=\"age\" required>\n        <a-input-number v-model:value=\"formData.age\" :min=\"0\" style=\"width: 100%\" />\n      </a-form-item>\n    </template>\n  </MxFormModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { MxFormModal, useModal } from '@/components/MxModal'\nimport type { UseModalReturn } from '@/components/MxModal/useModal'\nimport type { Rule } from 'ant-design-vue/es/form'\n\ninterface Props {\n  modal?: UseModalReturn\n}\n\nconst props = defineProps<Props>()\nconst modal = props.modal || useModal()\n\n// 表单验证规则\nconst rules: Record<string, Rule[]> = {\n  name: [{ required: true, message: '请输入姓名', trigger: 'blur' }],\n  age: [{ required: true, message: '请输入年龄', trigger: 'blur' }]\n}\n\n// 处理提交（确认按钮事件入口）\nconst handleSubmit = async (values: Record<string, any>) => {\n  try {\n    // 在这里调用接口\n    // const result = await api.addUser(values)\n\n    // 接口成功后，关闭弹窗\n    modal.resolve(values)\n    modal.hide()\n  } catch (error) {\n    // 接口失败，不关闭弹窗（让用户看到错误信息）\n    console.error('提交失败:', error)\n  }\n}\n</script>\n```\n\n#### 方式2：使用 MxModal（适用于非表单场景）\n\n```vue\n<!-- components/ConfirmModal.vue -->\n<template>\n  <MxModal :modal=\"modal\" @ok=\"handleOk\" @cancel=\"handleCancel\">\n    <p>{{ message }}</p>\n  </MxModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { MxModal, useModal } from '@/components/MxModal'\nimport type { UseModalReturn } from '@/components/MxModal/useModal'\n\ninterface Props {\n  modal?: UseModalReturn\n  message?: string\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  message: '确认执行此操作？'\n})\n\nconst modal = props.modal || useModal()\n\nconst handleOk = () => {\n  modal.resolve(true)\n  modal.hide()\n}\n\nconst handleCancel = () => {\n  modal.hide()\n}\n</script>\n```\n\n#### 方式3：直接使用 a-modal（高级用法）\n\n```vue\n<!-- components/UserModal.vue -->\n<template>\n  <a-modal\n    :open=\"modal.visible.value\"\n    v-bind=\"modalProps\"\n    @cancel=\"modal.hide()\"\n    @after-close=\"modal.remove()\"\n    @ok=\"handleOk\"\n  >\n    <a-form :model=\"formData\" layout=\"vertical\">\n      <a-form-item label=\"姓名\" name=\"name\" required>\n        <a-input v-model:value=\"formData.name\" placeholder=\"请输入姓名\" />\n      </a-form-item>\n      <a-form-item label=\"年龄\" name=\"age\" required>\n        <a-input-number v-model:value=\"formData.age\" :min=\"0\" style=\"width: 100%\" />\n      </a-form-item>\n    </a-form>\n  </a-modal>\n</template>\n\n<script setup lang=\"ts\">\nimport { reactive, computed } from 'vue'\nimport { useModal } from '@/components/MxModal'\nimport type { ModalProps } from 'ant-design-vue'\n\nconst modal = useModal()\n\n// 使用 getFormData 获取业务数据（自动排除 a-modal 参数）\nconst formData = reactive({\n  name: '',\n  age: undefined,\n  ...modal.getFormData<{ name: string; age: number }>()\n})\n\n// 使用 getModalProps 获取 a-modal 参数（自动提取）\nconst modalProps = computed<ModalProps>(() => ({\n  title: '用户信息',\n  width: 600,\n  ...modal.getModalProps() // 自动提取所有 a-modal 的参数\n}))\n\nconst handleOk = () => {\n  // 提交数据并关闭\n  modal.resolve({ ...formData })\n  modal.hide()\n}\n</script>\n```\n\n### 3. 使用 Modal（无需注册）\n\n```vue\n<!-- views/UserList.vue -->\n<template>\n  <mx-button @click=\"handleAdd\">新增用户</mx-button>\n</template>\n\n<script setup lang=\"ts\">\nimport { useModalController } from '@/components/MxModal'\nimport UserModal from '@/components/UserModal.vue'\n\n// 创建 Modal 控制器（自动注册）\nconst modal = useModalController(UserModal)\n\nconst handleAdd = async () => {\n  // 可以传递业务数据和 a-modal 的参数\n  const result = await modal.show({\n    // 业务数据\n    name: '',\n    age: 0,\n    // a-modal 的参数（可选）\n    title: '新增用户',\n    width: 800,\n    okText: '保存',\n    cancelText: '取消',\n    maskClosable: false\n  })\n\n  if (result) {\n    console.log('用户提交的数据:', result)\n    // 调用 API 保存数据\n  }\n}\n</script>\n```\n\n## API\n\n### MxModalProvider\n\n全局 Provider 组件，需要在 App 根组件中包裹。\n\n### useModal()\n\n在 Modal 组件内部使用的 Hook，返回：\n\n- `visible: Ref<boolean>` - Modal 是否可见\n- `args: Ref<Record<string, any>>` - Modal 参数（包含业务数据和 a-modal 参数）\n- `show(args?)` - 显示 Modal\n- `hide()` - 隐藏 Modal\n- `remove()` - 移除 Modal\n- `update(args)` - 更新参数\n- `resolve(value)` - 解析 Promise（用于命令式调用，将数据返回给调用者）\n- `reject(reason)` - 拒绝 Promise\n- `getFormData<T>(keys?)` - 获取业务数据（自动排除 a-modal 参数）\n  - `keys?: string[]` - 可选，指定要获取的字段，不传则返回所有业务数据\n- `getModalProps()` - 获取 a-modal 的参数（自动提取）\n\n### useModalController(component)\n\n创建 Modal 控制器（推荐使用），自动注册组件，返回：\n\n- `show(args?)` - 显示 Modal，返回 Promise\n  - `args` 可以包含业务数据和 `a-modal` 的所有参数（如 `title`, `width`, `okText`, `cancelText`, `maskClosable` 等）\n- `hide()` - 隐藏 Modal\n- `remove()` - 移除 Modal\n\n```ts\nconst modal = useModalController(UserModal)\n\n// 传递业务数据和 a-modal 参数\nconst result = await modal.show({\n  // 业务数据\n  userId: 123,\n  // a-modal 参数（可选）\n  title: '编辑用户',\n  width: 800,\n  okText: '确定',\n  cancelText: '取消'\n})\n```\n\n**注意**：\n\n- 如果使用 `MxFormModal` 或 `MxModal`，它们会自动处理 `a-modal` 参数的绑定\n- 如果直接使用 `a-modal`，需要通过 `modal.args.value` 访问这些参数，并使用 `v-bind` 绑定到 `a-modal` 上\n\n### removeAll()\n\n移除所有 Modal。\n\n## 完整示例\n\n```vue\n<!-- views/UserList.vue -->\n<template>\n  <mx-button @click=\"handleAdd\">新增用户</mx-button>\n</template>\n\n<script setup lang=\"ts\">\nimport { useModalController } from '@/components/MxModal'\nimport UserModal from '@/components/UserModal.vue'\n\n// 创建 Modal 控制器\nconst modal = useModalController(UserModal)\n\nconst handleAdd = async () => {\n  const result = await modal.show({ name: '', age: 0 })\n\n  if (result) {\n    console.log('用户提交的数据:', result)\n    // 调用 API 保存数据\n  } else {\n    // 用户取消了操作\n    console.log('用户取消了操作')\n  }\n}\n</script>\n```\n"
    },
    {
      "file_path": "src/components/MxModal/index.ts",
      "content": "/*\n * @Author: liaokt\n * @Description: MxModal 模块导出和全局 API\n * @Date: 2025-11-13 11:30:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 12:30:00\n */\nimport MxModalProvider from './MxModalProvider.vue'\n\n// 从 modalRegistry 重新导出，避免循环依赖\nexport { modalRegistry, register, show, hide, remove, removeAll } from './modalRegistry'\n\nexport { MxModalProvider }\nexport { useModal, useModalController, type UseModalReturn } from './useModal'\nexport { default as MxModal } from './MxModal.vue'\nexport { default as MxFormModal } from './MxFormModal.vue'\nexport { default as MxDetailModal } from './MxDetailModal.vue'\n"
    },
    {
      "file_path": "src/components/MxModal/modalRegistry.ts",
      "content": "/*\n * @Author: liaokt\n * @Description: Modal 注册表和相关函数，避免循环依赖\n * @Date: 2025-11-13 12:30:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 14:16:51\n */\nimport { defineComponent, h, watch, type Component } from 'vue'\nimport type { UseModalReturn } from './useModal'\n\n// Modal 注册表\nexport const modalRegistry = new Map<string, Component>()\n\n// 当前显示的 Modal 实例映射 (instanceId -> modal instance)\nexport const modalInstances = new Map<string, UseModalReturn>()\n\n// 全局存储 provider 实例（由 MxModalProvider 设置）\nlet globalProvider: {\n  register: (id: string, component: Component, props?: Record<string, any>) => void\n  unregister: (id: string) => void\n  update: (id: string, props: Partial<Record<string, any>>) => void\n  removeAll: () => void\n} | null = null\n\n/** 设置全局 Provider（由 MxModalProvider 调用） */\nexport function setGlobalProvider(provider: {\n  register: (id: string, component: Component, props?: Record<string, any>) => void\n  unregister: (id: string) => void\n  update: (id: string, props: Partial<Record<string, any>>) => void\n  removeAll: () => void\n}) {\n  globalProvider = provider\n}\n\n/** 获取 Modal Provider 的方法 */\nfunction getModalProvider() {\n  if (!globalProvider) {\n    console.warn('MxModalProvider 未找到，请确保在 App 中包裹 MxModalProvider')\n    return {\n      register: () => {\n        console.warn('MxModalProvider 未找到，无法注册 Modal')\n      },\n      unregister: () => {},\n      update: () => {},\n      removeAll: () => {}\n    }\n  }\n  return globalProvider\n}\n\n/**\n * 注册 Modal 组件\n */\nexport function register(id: string, component: Component) {\n  modalRegistry.set(id, component)\n}\n\n/**\n * 显示 Modal\n */\nexport async function show<T = any>(id: string, args?: Record<string, any>): Promise<T | null> {\n  const component = modalRegistry.get(id)\n  if (!component) {\n    throw new Error(`Modal \"${id}\" 未注册`)\n  }\n\n  const provider = getModalProvider()\n  const instanceId = `${id}-${Date.now()}-${Math.random()}`\n\n  // 动态导入 useModal，避免循环依赖\n  const { useModal } = await import('./useModal')\n  const modal = useModal()\n\n  return new Promise<T | null>((resolve, reject) => {\n    // 设置初始参数\n    if (args) {\n      modal.args.value = { ...args }\n    }\n\n    // 注入 resolve/reject 到 modal 实例\n    ;(modal as any)._resolve = (value: T) => {\n      ;(modal as any)._resolved = true\n      resolve(value)\n      provider.unregister(instanceId)\n      modalInstances.delete(instanceId)\n    }\n    ;(modal as any)._reject = (reason?: any) => {\n      reject(reason)\n      provider.unregister(instanceId)\n      modalInstances.delete(instanceId)\n    }\n\n    // 监听 visible 变化，处理取消情况\n    watch(\n      () => modal.visible.value,\n      visible => {\n        if (!visible && !(modal as any)._resolved) {\n          // 用户关闭了 Modal（非 resolve），resolve null\n          setTimeout(() => {\n            if (!(modal as any)._resolved) {\n              ;(modal as any)._resolved = true\n              resolve(null)\n              provider.unregister(instanceId)\n              modalInstances.delete(instanceId)\n            }\n          }, 300) // 等待动画完成\n        }\n      }\n    )\n\n    // 创建包装组件\n    const wrapperComponent = defineComponent({\n      setup() {\n        // 显示 Modal\n        modal.show(args)\n\n        return () =>\n          h(component, {\n            modal,\n            ...modal.args.value\n          })\n      }\n    })\n\n    // 注册到 Provider\n    provider.register(instanceId, wrapperComponent, {})\n    modalInstances.set(instanceId, modal)\n  })\n}\n\n/**\n * 隐藏 Modal\n */\nexport function hide(id: string) {\n  // 找到所有匹配的实例并隐藏\n  for (const [instanceId, modal] of modalInstances.entries()) {\n    if (instanceId.startsWith(`${id}-`)) {\n      modal.hide()\n    }\n  }\n}\n\n/**\n * 移除 Modal\n */\nexport function remove(id: string) {\n  const provider = getModalProvider()\n  // 找到所有匹配的实例并移除\n  const toRemove: string[] = []\n  for (const instanceId of modalInstances.keys()) {\n    if (instanceId.startsWith(`${id}-`)) {\n      toRemove.push(instanceId)\n    }\n  }\n  toRemove.forEach(instanceId => {\n    provider.unregister(instanceId)\n    modalInstances.delete(instanceId)\n  })\n}\n\n/**\n * 移除所有 Modal\n */\nexport function removeAll() {\n  const provider = getModalProvider()\n  provider.removeAll()\n  modalInstances.clear()\n}\n"
    },
    {
      "file_path": "src/components/MxModal/useModal.ts",
      "content": "/*\n * @Author: liaokt\n * @Description: useModal Hook - 管理单个 Modal 的状态\n * @Date: 2025-11-13 11:30:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 11:30:00\n */\nimport { ref, toRaw, type Ref, type Component } from 'vue'\n\n// 从 modalRegistry 导入，避免循环依赖\nimport { modalRegistry, register, show, hide, remove } from './modalRegistry'\n\nexport interface UseModalReturn {\n  /** Modal 是否可见 */\n  visible: Ref<boolean>\n  /** Modal 参数 */\n  args: Ref<Record<string, any>>\n  /** 显示 Modal */\n  show: (args?: Record<string, any>) => void\n  /** 隐藏 Modal */\n  hide: () => void\n  /** 移除 Modal（从 DOM 中移除） */\n  remove: () => void\n  /** 更新参数 */\n  update: (args: Partial<Record<string, any>>) => void\n  /** 解析 Promise（用于命令式调用） */\n  resolve: (value: any) => void\n  /** 拒绝 Promise（用于命令式调用） */\n  reject: (reason?: any) => void\n  /** 获取业务数据（排除 a-modal 的常用参数） */\n  getFormData: <T = Record<string, any>>(keys?: string[]) => T\n  /** 获取 a-modal 的参数 */\n  getModalProps: () => Record<string, any>\n}\n\nexport interface UseModalController<T = any> {\n  /** 显示 Modal */\n  show: (args?: Record<string, any>) => Promise<T | null>\n  /** 隐藏 Modal */\n  hide: () => void\n  /** 移除 Modal */\n  remove: () => void\n}\n\n/**\n * useModal Hook - 用于在 Modal 组件内部管理状态\n *\n * @example\n * ```vue\n * <template>\n *   <a-modal\n *     :open=\"modal.visible.value\"\n *     @cancel=\"modal.hide()\"\n *     @after-close=\"modal.remove()\"\n *   >\n *     <h1>这是一个 Modal</h1>\n *   </a-modal>\n * </template>\n *\n * <script setup lang=\"ts\">\n * import { useModal } from '@/components/MxModal/useModal'\n *\n * const modal = useModal()\n * </script>\n * ```\n */\nexport function useModal(): UseModalReturn {\n  const visible = ref(false)\n  const args = ref<Record<string, any>>({})\n  let resolveFn: ((value: any) => void) | null = null\n  let rejectFn: ((reason?: any) => void) | null = null\n\n  const show = (newArgs?: Record<string, any>) => {\n    if (newArgs) {\n      args.value = { ...args.value, ...newArgs }\n    }\n    visible.value = true\n  }\n\n  const hide = () => {\n    visible.value = false\n  }\n\n  const remove = () => {\n    visible.value = false\n    args.value = {}\n    resolveFn = null\n    rejectFn = null\n  }\n\n  const update = (newArgs: Partial<Record<string, any>>) => {\n    args.value = { ...args.value, ...newArgs }\n  }\n\n  let modalInstance: any = null\n\n  const resolve = (value: any) => {\n    // 优先使用注入的 _resolve（来自 modalRegistry）\n    // modalRegistry 会将 _resolve 注入到返回对象上\n    if (modalInstance?._resolve) {\n      modalInstance._resolve(value)\n      return\n    }\n    // 否则使用本地的 resolveFn\n    if (resolveFn) {\n      resolveFn(value)\n      resolveFn = null\n    }\n  }\n\n  const reject = (reason?: any) => {\n    if (rejectFn) {\n      rejectFn(reason)\n      rejectFn = null\n    }\n  }\n\n  // a-modal 的常用参数列表（用于区分业务数据和 Modal 参数）\n  const modalPropKeys = [\n    'title',\n    'width',\n    'okText',\n    'cancelText',\n    'maskClosable',\n    'keyboard',\n    'centered',\n    'closable',\n    'destroyOnClose',\n    'footer',\n    'okType',\n    'cancelButtonProps',\n    'okButtonProps',\n    'confirmLoading',\n    'zIndex',\n    'wrapClassName',\n    'getContainer',\n    'mask',\n    'maskStyle',\n    'bodyStyle',\n    'wrapStyle',\n    'class',\n    'style',\n    'data' // data 用于包裹业务数据，不应该被包含在表单数据中\n  ]\n\n  /** 获取业务数据（排除 a-modal 的参数） */\n  const getFormData = <T = Record<string, any>>(keys?: string[]): T => {\n    // 使用 toRaw 避免响应式追踪导致的循环\n    const allArgs = toRaw(args.value)\n    if (keys) {\n      // 如果指定了 keys，只返回这些字段\n      const result: Record<string, any> = {}\n      keys.forEach(key => {\n        if (key in allArgs) {\n          result[key] = allArgs[key]\n        }\n      })\n      return result as T\n    }\n    // 否则排除所有 a-modal 的参数\n    const result: Record<string, any> = {}\n    Object.keys(allArgs).forEach(key => {\n      if (!modalPropKeys.includes(key)) {\n        result[key] = allArgs[key]\n      }\n    })\n    return result as T\n  }\n\n  /** 获取 a-modal 的参数 */\n  const getModalProps = (): Record<string, any> => {\n    // 使用 toRaw 避免响应式追踪导致的循环\n    const allArgs = toRaw(args.value)\n    const result: Record<string, any> = {}\n    Object.keys(allArgs).forEach(key => {\n      if (modalPropKeys.includes(key)) {\n        result[key] = allArgs[key]\n      }\n    })\n    return result\n  }\n\n  const result = {\n    visible,\n    args,\n    show,\n    hide,\n    remove,\n    update,\n    resolve,\n    reject,\n    getFormData,\n    getModalProps\n  } as UseModalReturn & { _resolve?: (value: any) => void; _reject?: (reason?: any) => void }\n\n  // 让 resolve 函数能够访问返回对象上的 _resolve\n  modalInstance = result\n\n  return result\n}\n\n/**\n * useModalController - 用于创建 Modal 控制器（命令式使用）\n *\n * @example\n * ```ts\n * import { useModalController } from '@/components/MxModal'\n * import UserModal from './UserModal.vue'\n *\n * const modal = useModalController(UserModal)\n *\n * // 显示 Modal\n * const result = await modal.show({ name: '', age: 0 })\n *\n * if (result) {\n *   console.log('提交的数据:', result)\n * }\n * ```\n */\n// 获取模块函数\nfunction getModalModule() {\n  return {\n    modalRegistry,\n    register,\n    show,\n    hide,\n    remove\n  }\n}\n\nexport function useModalController<T = any>(component: Component): UseModalController<T> {\n  // 生成唯一 ID（使用组件名称或生成唯一 ID）\n  const componentName =\n    (component as any).__name ||\n    (component as any).name ||\n    `Modal${Date.now()}${Math.random().toString(36).substr(2, 9)}`\n  const componentId = `modal-${componentName}`\n\n  // 确保模块已加载并注册组件\n  let isRegistered = false\n  let registrationPromise: Promise<void> | null = null\n\n  return {\n    show: async (args?: Record<string, any>) => {\n      const module = getModalModule()\n      if (!isRegistered) {\n        if (!registrationPromise) {\n          registrationPromise = (async () => {\n            if (!module.modalRegistry.has(componentId)) {\n              module.register(componentId, component)\n            }\n            isRegistered = true\n          })()\n        }\n        await registrationPromise\n      }\n      return module.show(componentId, args) as Promise<T | null>\n    },\n    hide: () => {\n      const module = getModalModule()\n      module.hide(componentId)\n    },\n    remove: () => {\n      const module = getModalModule()\n      module.remove(componentId)\n    }\n  }\n}\n"
    },
    {
      "file_path": "src/components/MxResetButton/MxResetButton.vue",
      "content": "<template>\n  <mx-button\n    :type=\"type\"\n    :size=\"size\"\n    :disabled=\"disabled || loading\"\n    :loading=\"loading\"\n    :permission=\"permission\"\n    :custom-class=\"customClass\"\n    @click=\"handleReset\"\n  >\n    <template v-if=\"!hideIcon && !loading\" #icon>\n      <ReloadOutlined />\n    </template>\n    <slot>重置</slot>\n  </mx-button>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, onUnmounted, computed } from 'vue'\nimport { ReloadOutlined } from '@ant-design/icons-vue'\nimport { debounce as debounceFn } from 'lodash'\nimport MxButton from '../MxButton/MxButton.vue'\n\n/**\n * 重置按钮组件\n * 专用于重置/清空操作，自动添加重置图标\n * 支持权限控制、加载状态、防抖、键盘快捷键\n *\n * @example\n * ```vue\n * <!-- 基础用法 -->\n * <mx-reset-button @reset=\"handleReset\" />\n *\n * <!-- 防抖重置 -->\n * <mx-reset-button :debounce=\"300\" @reset=\"handleReset\" />\n *\n * <!-- 支持快捷键 -->\n * <mx-reset-button :keyboard=\"true\" @reset=\"handleReset\" />\n * ```\n */\ndefineOptions({\n  name: 'MxResetButton'\n})\n\nconst emit = defineEmits<{\n  reset: []\n}>()\n\ninterface Props {\n  /** 按钮类型 */\n  type?: 'primary' | 'default' | 'dashed' | 'text' | 'link'\n  /** 按钮尺寸 */\n  size?: 'large' | 'middle' | 'small'\n  /** 是否禁用 */\n  disabled?: boolean\n  /** 加载状态 */\n  loading?: boolean\n  /** 自定义类名 */\n  customClass?: string\n  /** 需要的权限，传入权限字符串或数组，有权限则显示按钮 */\n  permission?: string | string[]\n  /** 防抖延迟时间（毫秒），0 则不防抖 */\n  debounce?: number\n  /** 是否支持快捷键触发（Ctrl/Cmd + R） */\n  keyboard?: boolean\n  /** 是否隐藏图标 */\n  hideIcon?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  type: 'default',\n  size: 'middle',\n  disabled: false,\n  loading: false,\n  customClass: '',\n  permission: undefined,\n  debounce: 200, // 重置按钮默认不防抖\n  keyboard: false,\n  hideIcon: false\n})\n\n/** 防抖函数 */\nconst debouncedReset = computed(() => {\n  if (props.debounce > 0) {\n    return debounceFn(() => {\n      emit('reset')\n    }, props.debounce)\n  } else {\n    return () => emit('reset')\n  }\n})\n\n/** 处理重置点击 */\nconst handleReset = () => {\n  debouncedReset.value()\n}\n\n/** 处理键盘快捷键 */\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (props.keyboard && (event.ctrlKey || event.metaKey) && event.key === 'r') {\n    event.preventDefault()\n    if (!props.disabled && !props.loading) {\n      handleReset()\n    }\n  }\n}\n\n// 键盘事件监听\nonMounted(() => {\n  if (props.keyboard) {\n    document.addEventListener('keydown', handleKeyDown)\n  }\n})\n\nonUnmounted(() => {\n  if (props.keyboard) {\n    document.removeEventListener('keydown', handleKeyDown)\n  }\n  // 取消防抖\n  const debouncedFn = debouncedReset.value as any\n  if (debouncedFn && typeof debouncedFn.cancel === 'function') {\n    debouncedFn.cancel()\n  }\n})\n\nexport type { Props as MxResetButtonProps }\n</script>\n\n<style scoped lang=\"scss\"></style>\n"
    },
    {
      "file_path": "src/components/MxSearchButton/MxSearchButton.vue",
      "content": "<template>\n  <mx-button\n    :type=\"type\"\n    :size=\"size\"\n    :disabled=\"disabled || loading\"\n    :loading=\"loading\"\n    :permission=\"permission\"\n    :custom-class=\"customClass\"\n    @click=\"handleSearch\"\n  >\n    <template v-if=\"!hideIcon && !loading\" #icon>\n      <SearchOutlined />\n    </template>\n    <slot>搜索</slot>\n  </mx-button>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, onUnmounted, computed } from 'vue'\nimport { SearchOutlined } from '@ant-design/icons-vue'\nimport { debounce as debounceFn } from 'lodash'\nimport MxButton from '../MxButton/MxButton.vue'\n\n/**\n * 搜索按钮组件\n * 专用于搜索操作，自动添加搜索图标\n * 支持权限控制、加载状态、防抖、键盘快捷键\n *\n * @example\n * ```vue\n * <!-- 基础用法 -->\n * <mx-search-button @search=\"handleSearch\" />\n *\n * <!-- 防抖搜索 -->\n * <mx-search-button :debounce=\"300\" @search=\"handleSearch\" />\n *\n * <!-- 支持回车键 -->\n * <mx-search-button :enterSubmit=\"true\" @search=\"handleSearch\" />\n * ```\n */\ndefineOptions({\n  name: 'MxSearchButton'\n})\n\nconst emit = defineEmits<{\n  search: []\n}>()\n\ninterface Props {\n  /** 按钮类型 */\n  type?: 'primary' | 'default' | 'dashed' | 'text' | 'link'\n  /** 按钮尺寸 */\n  size?: 'large' | 'middle' | 'small'\n  /** 是否禁用 */\n  disabled?: boolean\n  /** 加载状态 */\n  loading?: boolean\n  /** 自定义类名 */\n  customClass?: string\n  /** 需要的权限，传入权限字符串或数组，有权限则显示按钮 */\n  permission?: string | string[]\n  /** 防抖延迟时间（毫秒），0 则不防抖 */\n  debounce?: number\n  /** 是否支持回车键触发搜索 */\n  enterSubmit?: boolean\n  /** 是否隐藏图标 */\n  hideIcon?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  type: 'primary',\n  size: 'middle',\n  disabled: false,\n  loading: false,\n  customClass: '',\n  permission: undefined,\n  debounce: 200,\n  enterSubmit: false,\n  hideIcon: false\n})\n\n/** 防抖函数 */\nconst debouncedSearch = computed(() => {\n  if (props.debounce > 0) {\n    return debounceFn(() => {\n      emit('search')\n    }, props.debounce)\n  } else {\n    return () => emit('search')\n  }\n})\n\n/** 处理搜索点击 */\nconst handleSearch = () => {\n  debouncedSearch.value()\n}\n\n/** 处理回车键 */\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (props.enterSubmit && event.key === 'Enter' && !props.disabled && !props.loading) {\n    event.preventDefault()\n    handleSearch()\n  }\n}\n\n// 键盘事件监听\nonMounted(() => {\n  if (props.enterSubmit) {\n    document.addEventListener('keydown', handleKeyDown)\n  }\n})\n\nonUnmounted(() => {\n  if (props.enterSubmit) {\n    document.removeEventListener('keydown', handleKeyDown)\n  }\n  // 取消防抖\n  const debouncedFn = debouncedSearch.value as any\n  if (debouncedFn && typeof debouncedFn.cancel === 'function') {\n    debouncedFn.cancel()\n  }\n})\n</script>\n\n<style scoped lang=\"scss\"></style>\n"
    },
    {
      "file_path": "src/components/MxTable/MxTable.vue",
      "content": "<template>\n  <div ref=\"tableContainerRef\" class=\"configurable-table\">\n    <!-- 搜索和操作工具栏 -->\n    <MxTableToolbar\n      v-if=\"searchList?.length\"\n      :search-list=\"searchList\"\n      :operate-list=\"operateList || []\"\n      @search=\"handleSearch\"\n      @reset=\"handleReset\"\n    />\n\n    <!-- 表格主体 -->\n    <a-table\n      :columns=\"processedColumns\"\n      :data-source=\"dataSource\"\n      :pagination=\"paginationConfig\"\n      :row-key=\"rowKey || 'id'\"\n      :loading=\"loading\"\n      :bordered=\"bordered\"\n      :size=\"size || 'middle'\"\n      :row-selection=\"selectionConfig\"\n      :scroll=\"mergedScroll\"\n      v-bind=\"$attrs\"\n      @change=\"handleTableChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, h, ref, toRefs } from 'vue'\nimport type { TableConfig } from './table'\nimport { formatDate, formatTime } from '@/utils/time/time'\nimport { getStatusConfigByValue } from '@/constants/status'\nimport MxTableToolbar from '@/components/MxTableToolbar/MxTableToolbar.vue'\nimport { Badge, Tag, Tooltip } from 'ant-design-vue'\nimport { useSize } from '@/hooks'\n\ninterface Props extends TableConfig {}\n\nconst props = defineProps<Props>()\n\n// 解构 props 保持响应式\nconst {\n  columns,\n  dataSource,\n  pagination,\n  rowKey,\n  loading,\n  bordered,\n  size,\n  searchList,\n  operateList,\n  scroll\n} = toRefs(props)\n\n// 表格容器引用\nconst tableContainerRef = ref<HTMLElement | null>(null)\n\n// 监听容器尺寸变化\nconst containerSize = useSize(\n  computed(() => tableContainerRef.value),\n  {\n    immediate: true,\n    listenWindowResize: false\n  }\n)\n\n// 计算表格滚动高度（容器高度 - 工具栏高度 - 分页高度 - 缓冲）\nconst calculatedScrollHeight = computed(() => {\n  const baseHeight = containerSize.value.height\n  if (baseHeight === 0) return undefined // 如果容器高度为0，不设置滚动高度\n\n  const toolbarHeight = searchList.value?.length ? 80 : 0 // 工具栏高度\n  const paginationHeight = pagination.value ? 60 : 0 // 分页高度\n  const buffer = 80 // 缓冲空间\n\n  const calculatedHeight = baseHeight - toolbarHeight - paginationHeight - buffer\n  return Math.max(calculatedHeight, 300) // 最小高度 300px\n})\n\n// 合并滚动配置：如果外部传入了 scroll，则合并；否则使用计算的高度\nconst mergedScroll = computed(() => {\n  if (scroll.value) {\n    // 如果外部传入了 scroll，合并 y 轴高度（优先使用计算的高度）\n    return {\n      ...scroll.value,\n      y: calculatedScrollHeight.value || scroll.value.y\n    }\n  }\n  // 如果没有传入 scroll，使用计算的高度\n  if (calculatedScrollHeight.value) {\n    return {\n      y: calculatedScrollHeight.value\n    }\n  }\n  return undefined\n})\n\n// 获取选择配置\nconst selection = computed(() => props.rowSelection)\n\n// 定义事件\nconst emit = defineEmits<{\n  paginationChange: [pagination: { current: number; pageSize: number }]\n  selectionChange: [selectedRowKeys: string[], selectedRows: any[]]\n  search: [params: Record<string, any>, reset?: boolean]\n  reset: [params: any]\n}>()\n\n// 通用文本渲染函数（带 Tooltip 和省略号）\nconst renderTextWithTooltip = (text: string, maxLength: number = 20) => {\n  if (!text) return h('span', '-')\n\n  if (text.length > maxLength) {\n    return h(\n      Tooltip,\n      {\n        title: text,\n        placement: 'topLeft'\n      },\n      {\n        default: () =>\n          h(\n            'span',\n            {\n              style: {\n                display: 'inline-block',\n                maxWidth: '100%',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap'\n              }\n            },\n            text\n          )\n      }\n    )\n  }\n\n  return h('span', text)\n}\n\n// 列值渲染函数\nconst renderColumnValue = (type: string, text: string, options?: any[], column?: any) => {\n  switch (type) {\n    case 'text':\n      return renderTextWithTooltip(text)\n\n    case 'tag':\n      return text\n        ? h(Tag, { color: column?.color || 'default' }, { default: () => text })\n        : h('span', '-')\n\n    case 'status': {\n      const statusConfig = getStatusConfigByValue(Number.parseInt(text))\n      const status = options?.find((opt: any) => opt.value === text)\n      return h(Badge, {\n        color: statusConfig.color,\n        text: status?.label || '-'\n      })\n    }\n\n    case 'date':\n      return h('span', formatDate(text))\n\n    case 'dateTime':\n      return h('span', formatTime(text))\n\n    case 'select': {\n      const option = options?.find((opt: any) => opt.value === text)\n      const displayText = option?.label || '-'\n      return renderTextWithTooltip(displayText)\n    }\n\n    default:\n      return renderTextWithTooltip(text)\n  }\n}\n\n// 列配置处理\nconst processedColumns = computed(() => {\n  return columns.value.map((column: any) => {\n    // 提取自定义属性，保留所有 Ant Design Vue 原生属性（包括 width）\n    const { type, options, color, customRender, ...columnConfig } = column\n\n    // 处理自定义渲染\n    if (type && !['custom'].includes(type)) {\n      // 如果已经有自定义渲染函数，优先使用\n      if (customRender) {\n        columnConfig.customRender = customRender\n      } else {\n        // 否则使用类型渲染\n        columnConfig.customRender = ({ text }: { text: any }) =>\n          renderColumnValue(type, text, options, { ...column, color })\n      }\n    } else if (type === 'custom' && customRender) {\n      // 自定义类型使用用户提供的渲染函数\n      columnConfig.customRender = customRender\n    }\n\n    // 确保所有列属性都被保留（包括 width, fixed, align, sorter 等）\n    return columnConfig\n  })\n})\n\n// 分页配置\nconst paginationConfig = computed(() => {\n  if (!pagination.value) return false\n\n  const {\n    current,\n    pageSize,\n    total,\n    showSizeChanger = true,\n    showQuickJumper = false\n  } = pagination.value\n\n  return {\n    current,\n    pageSize,\n    total,\n    showSizeChanger,\n    showQuickJumper,\n    showTotal: (total: number) => `共 ${total} 条`\n  }\n})\n\n// 内部选中状态\nconst internalSelectedRowKeys = ref<string[]>(\n  (selection.value?.selectedRowKeys || []).map(key => String(key))\n)\n\n// 选择配置\nconst selectionConfig = computed(() => {\n  if (!selection.value) return undefined\n\n  return {\n    ...selection.value,\n    selectedRowKeys: internalSelectedRowKeys.value,\n    onChange: (selectedRowKeys: any[], selectedRows: any[]) => {\n      internalSelectedRowKeys.value = selectedRowKeys.map(key => String(key))\n      emit('selectionChange', selectedRowKeys, selectedRows)\n      selection.value?.onChange?.(selectedRowKeys, selectedRows)\n    }\n  }\n})\n\n// 事件处理函数\nconst handleTableChange = (pagination: any, filters: any, sorter: any, extra?: any) => {\n  props.onChange?.(pagination, filters, sorter, extra)\n\n  if (pagination) {\n    emit('paginationChange', {\n      current: pagination.current,\n      pageSize: pagination.pageSize\n    })\n  }\n}\n\nconst handleSearch = (params: Record<string, any>, reset?: boolean) => {\n  emit('search', params, reset)\n}\n\nconst handleReset = (params: any) => {\n  emit('reset', params)\n}\n</script>\n\n<style scoped>\n.configurable-table {\n  width: 100%;\n}\n\n.table-title {\n  margin-bottom: 16px;\n}\n\n.table-title h3 {\n  margin: 0;\n  font-size: 16px;\n  font-weight: 600;\n  color: #1f2937;\n}\n</style>\n"
    },
    {
      "file_path": "src/router/index.ts",
      "content": "/*\n * @Author: liaokt\n * @Description:\n * @Date: 2025-11-10 15:26:49\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-11 15:32:00\n */\nimport { createRouter, createWebHistory } from 'vue-router'\nimport { useUserStore } from '@/store/user'\nimport Home from '../views/Home.vue'\n\nconst routes = [\n  {\n    path: '/',\n    name: 'Home',\n    component: Home,\n    meta: {\n      title: '首页',\n      requiresAuth: false\n    }\n  },\n  {\n    path: '/login',\n    name: 'Login',\n    component: () => import('../views/auth/login.vue'),\n    meta: {\n      title: '登录',\n      requiresAuth: false\n    }\n  },\n  {\n    path: '/packet-feature',\n    name: 'PacketFeatureDetail',\n    component: () => import('../views/packet-feature/detail.vue'),\n    meta: {\n      title: '包级特征管理',\n      requiresAuth: false\n    }\n  },\n  {\n    path: '/404',\n    name: 'NotFound',\n    component: () => import('../views/error/not-found.vue'),\n    meta: {\n      title: '页面不存在'\n    }\n  },\n  {\n    path: '/:pathMatch(.*)*',\n    redirect: '/404'\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(),\n  routes\n})\n\nconst authGuard: Parameters<typeof router.beforeEach>[0] = (to: any, _from: any, next: any) => {\n  const userStore = useUserStore()\n\n  if (to.meta.title) {\n    document.title = `${to.meta.title} - ${import.meta.env.VITE_APP_TITLE}`\n  }\n\n  if (to.meta.requiresAuth && !userStore.isLoggedIn) {\n    next({ name: 'Login', query: { redirect: to.fullPath } })\n    return\n  }\n\n  if (to.name === 'Login' && userStore.isLoggedIn) {\n    next((to.query.redirect as string) || '/')\n    return\n  }\n\n    next()\n  }\n\nrouter.beforeEach(authGuard)\n\nexport default router\n"
    },
    {
      "file_path": "src/views/packet-feature/components/AddFeatureModal.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: 新增/编辑包级特征弹框组件\n * @Date: 2025-11-12 18:00:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 18:41:13\n-->\n<template>\n  <MxFormModal :modal=\"modal\" :rules=\"rules\" layout=\"vertical\" @ok=\"handleSubmit\">\n    <template #default=\"{ formData }\">\n      <!-- 前四个字段，一行两个 -->\n      <MxFormRow :cols=\"2\">\n        <a-form-item label=\"数据包大小(KB)\" name=\"packetSize\" required>\n          <a-input-number\n            v-model:value=\"formData.packetSize\"\n            :min=\"0.1\"\n            :max=\"1000\"\n            :precision=\"1\"\n            :step=\"0.1\"\n            placeholder=\"范围: 0.1-1000 KB\"\n            style=\"width: 100%\"\n          />\n        </a-form-item>\n        <a-form-item label=\"TCP窗口大小(字节)\" name=\"tcpWindow\" required>\n          <a-input-number\n            v-model:value=\"formData.tcpWindow\"\n            :min=\"1024\"\n            :max=\"65535\"\n            :precision=\"0\"\n            placeholder=\"范围: 1024-65535 字节\"\n            style=\"width: 100%\"\n          />\n        </a-form-item>\n        <a-form-item label=\"端口号\" name=\"port\" required>\n          <a-input-number\n            v-model:value=\"formData.port\"\n            :min=\"1\"\n            :max=\"65535\"\n            :precision=\"0\"\n            placeholder=\"1-65535\"\n            style=\"width: 100%\"\n          />\n        </a-form-item>\n        <a-form-item label=\"MAC地址\" name=\"mac\" required>\n          <a-input v-model:value=\"formData.mac\" placeholder=\"XX:XX:XX:XX:XX:XX\" :maxlength=\"17\" />\n        </a-form-item>\n      </MxFormRow>\n\n      <!-- 其他字段，单列 -->\n      <a-form-item label=\"DNS域名字符串\" name=\"dns\">\n        <a-input v-model:value=\"formData.dns\" placeholder=\"可选\" />\n      </a-form-item>\n\n      <a-form-item label=\"HTTP响应报文\" name=\"httpStatus\">\n        <a-textarea v-model:value=\"formData.httpStatus\" :rows=\"4\" placeholder=\"可选\" />\n      </a-form-item>\n\n      <a-form-item label=\"关联设备类型\" name=\"deviceType\" required>\n        <a-select\n          v-model:value=\"formData.deviceType\"\n          placeholder=\"请选择设备类型\"\n          :options=\"DEVICE_TYPE_OPTIONS\"\n        />\n      </a-form-item>\n    </template>\n  </MxFormModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { toRaw } from 'vue'\nimport { MxFormModal, useModal } from '@/components/MxModal'\nimport type { UseModalReturn } from '@/components/MxModal/useModal'\nimport { MxFormRow } from '@/components/MxFormLayout'\nimport type { Rule } from 'ant-design-vue/es/form'\n\ndefineOptions({\n  name: 'AddFeatureModal'\n})\n\ninterface Props {\n  /** Modal 实例（从 modalRegistry 传递） */\n  modal?: UseModalReturn\n}\n\nconst DEVICE_TYPE_OPTIONS: { label: string; value: string }[] = [\n  { label: '智能电表', value: '智能电表' },\n  { label: '配电终端', value: '配电终端' },\n  { label: '采集器', value: '采集器' },\n  { label: '其他', value: '其他' }\n]\n\nconst props = defineProps<Props>()\n\n// 获取 modal 实例\nconst modal = props.modal || useModal()\n\n// 设备类型选项\n\n// MAC地址验证规则\nconst validateMac = (_rule: Rule, value: string) => {\n  if (!value) {\n    return Promise.reject(new Error('请输入MAC地址'))\n  }\n  const macRegex = /^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/\n  if (!macRegex.test(value)) {\n    return Promise.reject(new Error('MAC地址格式不正确，应为 XX:XX:XX:XX:XX:XX'))\n  }\n  return Promise.resolve()\n}\n\n// 表单验证规则\nconst rules: Record<string, Rule[]> = {\n  packetSize: [\n    { required: true, message: '请输入数据包大小', trigger: 'blur' },\n    { type: 'number', min: 0.1, max: 1000, message: '范围: 0.1-1000 KB', trigger: 'blur' }\n  ],\n  tcpWindow: [\n    { required: true, message: '请输入TCP窗口大小', trigger: 'blur' },\n    {\n      type: 'number',\n      min: 1024,\n      max: 65535,\n      message: '范围: 1024-65535 字节',\n      trigger: 'blur'\n    }\n  ],\n  port: [\n    { required: true, message: '请输入端口号', trigger: 'blur' },\n    { type: 'number', min: 1, max: 65535, message: '范围: 1-65535', trigger: 'blur' }\n  ],\n  mac: [{ validator: validateMac, trigger: 'blur' }],\n  deviceType: [{ required: true, message: '请选择设备类型', trigger: 'change' }]\n}\n\n// 处理提交（确认按钮事件入口）\nconst handleSubmit = async (values: Record<string, any>) => {\n  const args = toRaw(modal.args.value)\n  const isEdit = !!(args.id || args.type === 'edit')\n  try {\n    if (isEdit) {\n      // 编辑模式：调用更新接口\n      const id = modal.args.value.id\n      // TODO: 在这里调用更新接口\n      // const result = await api.updateFeature(id, values)\n      console.log('编辑特征:', id, values)\n\n      // 接口成功后，关闭弹窗\n      modal.resolve({ ...values, id, type: 'edit' })\n      modal.hide()\n    } else {\n      // 新增模式：调用创建接口\n      // TODO: 在这里调用创建接口\n      // const result = await api.addFeature(values)\n      console.log('新增特征:', values)\n\n      // 接口成功后，关闭弹窗\n      modal.resolve({ ...values, type: 'add' })\n      modal.hide()\n    }\n  } catch (error) {\n    // 接口失败，不关闭弹窗\n    console.error('提交失败:', error)\n  }\n}\n</script>\n\n<style scoped lang=\"scss\">\n.add-feature-modal__tip {\n  margin-bottom: 24px;\n  padding: 12px 16px;\n  background: #f0f7ff;\n  border-radius: 4px;\n  color: #1890ff;\n  font-size: 14px;\n\n  .required {\n    color: #ff4d4f;\n    margin: 0 2px;\n  }\n}\n\n:deep(.ant-form-item-label > label) {\n  &::before {\n    content: '';\n    display: none;\n  }\n\n  &.ant-form-item-required::before {\n    display: inline-block;\n    margin-right: 4px;\n    color: #ff4d4f;\n    font-size: 14px;\n    font-family: SimSun, sans-serif;\n    line-height: 1;\n    content: '*';\n  }\n}\n</style>\n"
    },
    {
      "file_path": "src/views/packet-feature/components/FeatureDetailModal.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: 特征详情弹窗组件\n * @Date: 2025-11-13 16:00:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 16:59:11\n-->\n<template>\n  <MxDetailModal\n    :modal=\"modal\"\n    :fields=\"detailFields\"\n    custom-class=\"feature-detail-modal\"\n    :show-ok=\"false\"\n    :show-cancel=\"false\"\n  >\n    <template #header>\n      <div class=\"feature-detail-modal__subtitle\">包级特征详细信息</div>\n    </template>\n    <template #footer>\n      <div class=\"feature-detail-modal__footer\">\n        <a-button type=\"primary\" @click=\"handleClose\">关闭</a-button>\n      </div>\n    </template>\n  </MxDetailModal>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useModal, type UseModalReturn, MxDetailModal } from '@/components/MxModal'\nimport type { DetailField } from '@/components/MxModal/MxDetailModal.vue'\nimport MacAddressValue from './MacAddressValue.vue'\n\ndefineOptions({\n  name: 'FeatureDetailModal'\n})\n\ninterface Props {\n  /** Modal 实例（从 modalRegistry 传递） */\n  modal?: UseModalReturn\n}\n\nconst props = defineProps<Props>()\n\n// 获取 modal 实例\nconst modal = props.modal || useModal()\n\nconst detailFields = computed<DetailField[]>(() => [\n  {\n    key: 'featureId',\n    label: '特征ID'\n  },\n  {\n    key: 'deviceType',\n    label: '设备类型',\n    type: 'tag'\n  },\n  {\n    key: 'packetSize',\n    label: '数据包大小',\n    suffix: ' KB'\n  },\n  {\n    key: 'tcpWindow',\n    label: 'TCP窗口大小',\n    suffix: ' 字节'\n  },\n  {\n    key: 'port',\n    label: '端口号'\n  },\n  {\n    key: 'mac',\n    label: 'MAC地址',\n    component: MacAddressValue\n  },\n  {\n    key: 'dns',\n    label: 'DNS域名字符串',\n    span: 24\n  },\n  {\n    key: 'httpStatus',\n    label: 'HTTP响应报文',\n    type: 'block',\n    span: 24\n  },\n  {\n    key: 'createdAt',\n    label: '创建时间',\n    span: 24\n  }\n])\n\n// 处理关闭\nconst handleClose = () => {\n  modal.hide()\n}\n</script>\n\n<style scoped lang=\"scss\">\n.feature-detail-modal {\n  min-width: 560px;\n\n  &__subtitle {\n    margin-bottom: 24px;\n    padding-bottom: 16px;\n    color: #8c8c8c;\n    font-size: 13px;\n    border-bottom: 1px solid #f0f0f0;\n  }\n\n  &__footer {\n    display: flex;\n    justify-content: flex-end;\n    padding-top: 16px;\n    border-top: 1px solid #f0f0f0;\n  }\n\n  :deep(.mx-detail-modal__label) {\n    color: #6f6f6f;\n    font-size: 13px;\n    font-weight: 500;\n    line-height: 1.6;\n  }\n\n  :deep(.mx-detail-modal__value) {\n    color: #1f1f1f;\n    font-size: 14px;\n    font-weight: 500;\n    line-height: 1.6;\n    word-break: break-word;\n  }\n\n  :deep(.mx-detail-modal__value--tag .ant-tag) {\n    margin-inline-end: 0;\n    padding: 3px 12px;\n    border-radius: 4px;\n    font-size: 13px;\n    font-weight: 500;\n    line-height: 22px;\n  }\n\n  :deep(.mx-detail-modal__value--block) {\n    display: inline-block;\n    padding: 12px 16px;\n    background: #fafafa;\n    border: 1px solid #f0f0f0;\n    border-radius: 4px;\n    font-size: 14px;\n    font-weight: 500;\n    color: #3f3f3f;\n    line-height: 1.7;\n  }\n}\n</style>\n"
    },
    {
      "file_path": "src/views/packet-feature/components/MacAddressValue.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: MAC 地址展示组件\n * @Date: 2025-11-13 17:20:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 17:20:00\n-->\n<template>\n  <span :class=\"['mac-address-value', { 'mac-address-value--empty': isEmpty }]\">\n    {{ isEmpty ? placeholder : displayValue }}\n  </span>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport type { DetailField } from '@/components/MxModal/MxDetailModal.vue'\n\ninterface Props {\n  value?: string\n  placeholder?: string\n  field: DetailField\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  value: '',\n  placeholder: '-'\n})\n\nconst isEmpty = computed(() => {\n  return props.value === null || props.value === undefined || String(props.value).trim() === ''\n})\n\nconst displayValue = computed(() => {\n  return String(props.value ?? '')\n})\n</script>\n\n<style scoped lang=\"scss\">\n.mac-address-value {\n  display: inline-block;\n  padding: 4px 10px;\n  font-family: 'SFMono-Regular', Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New',\n    monospace;\n  font-size: 14px;\n  letter-spacing: 0.6px;\n  color: #3f3f3f;\n  background: #f7f7fa;\n  border: 1px solid #ebeaf5;\n  border-radius: 4px;\n\n  &--empty {\n    font-family: inherit;\n    background: transparent;\n    border-color: transparent;\n    padding-left: 0;\n  }\n}\n</style>\n"
    },
    {
      "file_path": "src/views/packet-feature/detail.vue",
      "content": "<!--\n * @Author: liaokt\n * @Description: \n * @Date: 2025-11-12 17:44:21\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 17:46:17\n-->\n<!--\n * @Author: liaokt\n * @Description: 包级特征管理详情页\n * @Date: 2025-11-11 18:00:00\n * @LastEditors: liaokt\n * @LastEditTime: 2025-11-13 15:15:12\n-->\n<template>\n  <div :class=\"styles['packet-feature-detail']\">\n    <a-page-header\n      :class=\"styles['packet-feature-detail__header']\"\n      :title=\"pageTitle\"\n      sub-title=\"设备指纹库构建\"\n      @back=\"handleBack\"\n    >\n      <template #backIcon>\n        <ArrowLeftOutlined />\n        返回首页\n      </template>\n      <template #extra>\n        <a-tag color=\"blue\">数据来源：设备指纹库 V1.0</a-tag>\n      </template>\n    </a-page-header>\n\n    <div :class=\"styles['packet-feature-detail__content']\">\n      <a-card\n        :class=\"styles['packet-feature-detail__container']\"\n        title=\"包级特征管理列表\"\n        :bordered=\"false\"\n      >\n        <MxTable\n          v-bind=\"{\n            ...tableProps,\n            columns,\n            searchList,\n            operateList,\n            bordered: true\n          }\"\n          @search=\"handleSearch\"\n          @reset=\"handleReset\"\n        />\n      </a-card>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, h } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { message } from 'ant-design-vue'\nimport { ArrowLeftOutlined, EditOutlined, EyeOutlined } from '@ant-design/icons-vue'\nimport MxTable from '@/components/MxTable/MxTable.vue'\nimport MxTableAction from '@/components/MxTableAction/MxTableAction.vue'\nimport AddFeatureModal from './components/AddFeatureModal.vue'\nimport FeatureDetailModal from './components/FeatureDetailModal.vue'\nimport { useModalController } from '@/components/MxModal'\nimport { TableColumnTypeEnum } from '@/components/MxTable/table'\nimport type { OperateButtonConfig } from '@/components/MxTableToolbar/type'\nimport type { TableActionItem } from '@/components/MxTableAction/MxTableAction.vue'\nimport { useTable } from '@/hooks'\nimport styles from './detail.module.scss'\n\nconst router = useRouter()\nconst pageTitle = '包级特征管理'\n\n// 使用命令式 API 创建 Modal 控制器\nconst addFeatureModal = useModalController(AddFeatureModal)\nconst featureDetailModal = useModalController(FeatureDetailModal)\n\n// 模拟 API 函数\nconst fetchPacketFeatureList = async (params: any) => {\n  // 模拟延迟\n  await new Promise(resolve => setTimeout(resolve, 500))\n\n  // 模拟数据\n  const mockData = [\n    {\n      id: 'PF001',\n      featureId: 'PF001',\n      packetSize: '1.5',\n      tcpWindow: '8192',\n      port: 502,\n      mac: '00:1A:2B:3C:4D:5E',\n      dns: 'modbus.device.local',\n      httpStatus: 'HTTP/1.1 200 OK',\n      deviceType: '智能电表',\n      createdAt: '2024-01-15 10:30:00'\n    },\n    {\n      id: 'PF002',\n      featureId: 'PF002',\n      packetSize: '2.1',\n      tcpWindow: '16384',\n      port: 80,\n      mac: '00:2B:3C:4D:5E:6F',\n      dns: '-',\n      httpStatus: 'HTTP/1.1 404 Not Found',\n      deviceType: '配电终端',\n      createdAt: '2024-01-15 11:45:00'\n    },\n    {\n      id: 'PF003',\n      featureId: 'PF003',\n      packetSize: '1.8',\n      tcpWindow: '4096',\n      port: 443,\n      mac: '00:3C:4D:5E:6F:7A',\n      dns: 'https.device.local',\n      httpStatus: 'HTTP/1.1 200 OK',\n      deviceType: '采集器',\n      createdAt: '2024-01-16 09:20:00'\n    }\n  ]\n\n  // 模拟筛选\n  let filteredData = [...mockData]\n  if (params.featureId) {\n    filteredData = filteredData.filter(item =>\n      item.featureId.toLowerCase().includes(params.featureId.toLowerCase())\n    )\n  }\n  if (params.deviceType && params.deviceType !== 'all') {\n    filteredData = filteredData.filter(item => item.deviceType === params.deviceType)\n  }\n  if (params.mac) {\n    filteredData = filteredData.filter(item =>\n      item.mac.toLowerCase().includes(params.mac.toLowerCase())\n    )\n  }\n  if (params.port) {\n    filteredData = filteredData.filter(item => item.port === Number(params.port))\n  }\n\n  // 模拟分页\n  const { current = 1, pageSize = 20 } = params\n  const start = (current - 1) * pageSize\n  const end = start + pageSize\n  const list = filteredData.slice(start, end)\n\n  return {\n    list,\n    total: filteredData.length\n  }\n}\n\n// 使用 useTable hook\nconst { tableProps, search } = useTable(fetchPacketFeatureList, {\n  defaultPageSize: 20,\n  manual: false, // 自动加载\n  searchFormatter: params => {\n    // 过滤空值\n    const filtered: Record<string, any> = {}\n    Object.keys(params).forEach(key => {\n      if (params[key] !== undefined && params[key] !== '' && params[key] !== null) {\n        filtered[key] = params[key]\n      }\n    })\n    return filtered\n  }\n})\n\n// 表格列配置\nconst columns = ref([\n  {\n    key: 'featureId',\n    title: '特征ID',\n    dataIndex: 'featureId',\n    width: 140,\n    align: 'center' as const,\n    fixed: 'left' as const,\n    type: TableColumnTypeEnum.TEXT\n  },\n  {\n    key: 'packetSize',\n    title: '数据包大小(KB)',\n    dataIndex: 'packetSize',\n    width: 150,\n    align: 'center' as const,\n    type: TableColumnTypeEnum.TEXT\n  },\n  {\n    key: 'tcpWindow',\n    title: 'TCP窗口大小(字节)',\n    dataIndex: 'tcpWindow',\n    width: 180,\n    align: 'center' as const,\n    type: TableColumnTypeEnum.TEXT\n  },\n  {\n    key: 'port',\n    title: '端口号',\n    dataIndex: 'port',\n    width: 100,\n    align: 'center' as const,\n    type: TableColumnTypeEnum.TEXT\n  },\n  {\n    key: 'mac',\n    title: 'MAC地址',\n    dataIndex: 'mac',\n    width: 200,\n    type: TableColumnTypeEnum.TEXT\n  },\n  {\n    key: 'dns',\n    title: 'DNS域名字符串',\n    dataIndex: 'dns',\n    width: 200,\n    type: TableColumnTypeEnum.TEXT\n  },\n  {\n    key: 'httpStatus',\n    title: 'HTTP响应报文',\n    dataIndex: 'httpStatus',\n    width: 200,\n    type: TableColumnTypeEnum.TAG,\n    color: 'blue'\n  },\n  {\n    key: 'deviceType',\n    title: '关联设备类型',\n    dataIndex: 'deviceType',\n    width: 140,\n    align: 'center' as const,\n    type: TableColumnTypeEnum.TAG,\n    color: 'blue'\n  },\n  {\n    key: 'createdAt',\n    title: '创建时间',\n    dataIndex: 'createdAt',\n    width: 180,\n    type: TableColumnTypeEnum.DATETIME\n  },\n  {\n    key: 'actions',\n    title: '操作',\n    width: 120,\n    fixed: 'right' as const,\n    type: TableColumnTypeEnum.CUSTOM,\n    customRender: ({ record }: { record: any }) => {\n      const actions: TableActionItem[] = [\n        {\n          key: 'detail',\n          icon: EyeOutlined,\n          onClick: () => handleDetail(record)\n        },\n        {\n          key: 'edit',\n          icon: EditOutlined,\n          onClick: () => handleEdit(record)\n        },\n        {\n          key: 'delete',\n          actionType: 'delete',\n          deleteProps: {\n            confirm: '确认删除该特征？',\n            confirmType: 'popconfirm'\n          },\n          onClick: () => handleDelete(record)\n        }\n      ]\n\n      return h(MxTableAction, {\n        actions,\n        size: 'small',\n        spacing: 8\n      })\n    }\n  }\n])\n\n// 搜索配置\nconst DEVICE_TYPE_OPTIONS: { key: string; value: string }[] = [\n  { key: 'all', value: '全部设备' },\n  { key: '智能电表', value: '智能电表' },\n  { key: '配电终端', value: '配电终端' },\n  { key: '采集器', value: '采集器' },\n  { key: '其他', value: '其他' }\n]\n\nconst searchList = ref([\n  {\n    type: 'input' as const,\n    key: 'featureId',\n    name: '特征ID',\n    placeholder: '请输入特征ID',\n    width: 200\n  },\n  {\n    type: 'select' as const,\n    key: 'deviceType',\n    name: '设备类型',\n    placeholder: '请选择设备类型',\n    width: 220,\n    options: DEVICE_TYPE_OPTIONS\n  },\n  {\n    type: 'input' as const,\n    key: 'mac',\n    name: 'MAC地址',\n    placeholder: '请输入MAC地址',\n    isHidden: true // 高级搜索\n  },\n  {\n    type: 'input' as const,\n    key: 'port',\n    name: '端口号',\n    placeholder: '请输入端口号',\n    isHidden: true // 高级搜索\n  }\n])\n\n// 操作按钮配置\nconst operateList = ref<OperateButtonConfig[]>([\n  {\n    label: '新增包级特征',\n    type: 'primary' as const,\n    componentProps: {\n      iconType: 'add'\n    },\n    onClick: () => {\n      handleAdd()\n    }\n  },\n  {\n    label: '批量导入特征',\n    buttonType: 'import',\n    componentProps: {\n      uploadType: 'button',\n      accept: '.xlsx,.xls,.csv',\n      action: '/api/packet-feature/import',\n      maxSize: 10, // 最大文件大小 10MB\n      multiple: false\n    },\n    onImport: fileList => {\n      console.log('导入文件列表:', fileList)\n      message.success('导入成功')\n      // 刷新表格数据\n      //   search.submit({})\n    },\n    onImportChange: info => {\n      // 只处理错误状态，成功状态由 onImport 处理\n      if (info.file.status === 'error') {\n        message.error('文件上传失败')\n      }\n    }\n  }\n])\n\n// 事件处理\nconst handleBack = () => {\n  router.push('/')\n}\n\nconst handleSearch = (params: Record<string, any>, reset?: boolean) => {\n  console.log('搜索参数:', params, '是否重置:', reset)\n  if (reset) {\n    search.reset()\n  } else {\n    search.submit(params)\n  }\n}\n\nconst handleReset = (params: any) => {\n  console.log('重置参数:', params)\n  search.reset()\n}\n\n// 打开特征详情弹窗\nconst handleDetail = (record: any) => {\n  featureDetailModal.show({\n    title: '特征详情',\n    width: 600,\n    data: record\n  })\n}\n\n// 打开编辑特征弹框\nconst normalizeEditData = (record: any) => {\n  const toNumber = (value: any) => {\n    const num = Number(value)\n    return Number.isNaN(num) ? undefined : num\n  }\n\n  return {\n    ...record,\n    packetSize: toNumber(record.packetSize),\n    tcpWindow: toNumber(record.tcpWindow),\n    port: toNumber(record.port)\n  }\n}\n\nconst handleEdit = async (record: any) => {\n  try {\n    const result = await addFeatureModal.show({\n      title: '编辑包级特征',\n      width: 500,\n      id: record.featureId, // 传入 id，用于判断是编辑模式\n      type: 'edit', // 或者使用 type: 'edit'\n      // 使用 data 包裹业务数据\n      data: normalizeEditData(record)\n    })\n\n    if (result) {\n      // 用户提交了表单\n      console.log(result, '----编辑结果----')\n      await handleEditSubmit(result)\n    }\n  } catch (error) {\n    console.error('打开编辑弹窗失败:', error)\n  }\n}\n\n// 处理编辑提交\nconst handleEditSubmit = async (data: any) => {\n  try {\n    // TODO: 调用更新接口\n    // await api.updateFeature(data.id, data)\n    console.log('编辑提交的数据:', data)\n    message.success('编辑成功')\n    // 刷新表格\n    search.submit({})\n  } catch (error) {\n    message.error('编辑失败')\n    console.error('编辑失败:', error)\n  }\n}\n\nconst handleDelete = (record: any) => {\n  message.success(`已删除特征 ${record.featureId}`)\n  console.log('删除特征', record)\n  // 这里可以调用 API 删除数据，然后刷新表格\n  search.submit({})\n}\n\n// 打开新增特征弹框\nconst handleAdd = async () => {\n  try {\n    const result = await addFeatureModal.show({\n      title: '新增包级特征',\n      width: 500\n    })\n\n    if (result) {\n      // 用户提交了表单\n      console.log(result, '----result----')\n      await handleAddSubmit(result)\n    }\n    // 如果 result 为 null，说明用户取消了操作，不需要处理\n  } catch (error) {\n    console.error('打开弹框失败:', error)\n  }\n}\n\n// 新增特征提交\nconst handleAddSubmit = async (data: any) => {\n  try {\n    // 模拟 API 调用\n    await new Promise(resolve => setTimeout(resolve, 1000))\n\n    // 生成特征ID\n    const featureId = `PF${String(Math.floor(Math.random() * 10000)).padStart(4, '0')}`\n\n    console.log('新增特征数据:', { ...data, featureId })\n    message.success('新增包级特征成功')\n\n    // 刷新表格数据\n    search.submit({})\n  } catch (error) {\n    console.error('新增特征失败:', error)\n    message.error('新增包级特征失败')\n    throw error // 重新抛出错误，让调用者知道失败了\n  }\n}\n</script>\n"
    },
    {
      "file_path": "vite.config.ts",
      "content": "import { defineConfig } from 'vite'\nimport vue from '@vitejs/plugin-vue'\nimport vueJsx from '@vitejs/plugin-vue-jsx'\nimport VueDevTools from 'vite-plugin-vue-devtools'\nimport { fileURLToPath, URL } from 'node:url'\nimport { viteMockServe } from 'vite-plugin-mock'\nimport type { Plugin } from 'vite'\n\nexport default defineConfig(({ command }) => {\n  const isDev = command === 'serve'\n  return {\n    plugins: [\n      vue(),\n      vueJsx(),\n      VueDevTools(),\n      viteMockServe({\n        mockPath: 'mock',\n        enable: isDev\n      }) as Plugin\n    ],\n    resolve: {\n      alias: {\n        '@': fileURLToPath(new URL('./src', import.meta.url))\n      }\n    },\n    css: {\n      preprocessorOptions: {\n        scss: {\n          api: 'modern-compiler'\n        }\n      }\n    },\n    server: {\n      port: 8080,\n      open: true\n    },\n    build: {\n      outDir: 'dist',\n      assetsDir: 'assets',\n      sourcemap: true\n    }\n  }\n})\n"
    }
  ]
}
